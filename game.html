<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Arbeidskrav 1!</title>
    <link rel="stylesheet" href="game.css" />
  </head>
  <!-- HTML KODEN TRENGER DU IKKE RØRE FOR Å LØSE OPPGAVENE. -->

  <body>
    <div class="main-container">
      <!-- Healthbars til heroene -->
      <div class="hero-health-containers">
        <div class="healthbar-container">
          <!-- healer-health sin vidde må forandres for å endre lifebar -->
          <div class="healthbar healer-health"></div>
          <div class="text-container">
            <p id="healer-name-txt">Henriette</p>
            <p id="healer-health-txt">400 / 400 HP</p>
          </div>
        </div>
        <div class="healthbar-container">
          <!-- archer-health sin vidde må forandres for å endre lifebar -->
          <div class="healthbar archer-health"></div>
          <div class="text-container">
            <p id="archer-name-txt">Ariana</p>
            <p id="archer-health-txt">600 / 600 HP</p>
          </div>
        </div>
        <div class="healthbar-container">
          <!-- warrior-health sin vidde må forandres for å endre lifebar -->
          <div class="healthbar warrior-health"></div>
          <div class="text-container">
            <p id="warrior-name-txt">Wyona</p>
            <p id="warrior-health-txt">800 / 800 HP</p>
          </div>
        </div>
      </div>

      <!-- Healthbar til fienden -->
      <div class="dragon-health-container">
        <div class="healthbar-container">
          <!-- dragon-health sin vidde må forandres for å endre lifebar -->
          <div class="healthbar dragon-health"></div>
          <div class="text-container">
            <p id="dragon-name-txt">Daar</p>
            <div class="text-container dragon-health-txt">2000 / 2000 HP</div>
          </div>
        </div>
      </div>

      <!-- Bildecontainere for heroene -->
      <div class="img-container healer">
        <img class="hero" src="assets/healer.png" />
      </div>
      <div class="img-container archer">
        <img class="hero" src="assets/archer.png" />
      </div>
      <div class="img-container warrior">
        <img class="hero" src="assets/warrior.png" />
      </div>

      <!-- Bildecontainer for fienden -->
      <div class="enemy-container">
        <div class="img-container dragon-container">
          <img class="dragon" src="assets/dragon.png" />
        </div>
      </div>
    </div>

    <script>
      //Denne JS-koden er laget klar for deg. Den trenger du ikke endre på.

      //Stats for heroes
      let heroesArray = [
        {
          id: 0,
          name: "Henriette Healer",
          maxHP: 400,
          currentHP: 400,
          damage: 100,
          alive: true,
        },
        {
          id: 1,
          name: "Ariana Archer",
          maxHP: 500,
          currentHP: 500,
          damage: 400,
          alive: true,
        },
        {
          id: 2,
          name: "Wyona Warrior",
          maxHP: 600,
          currentHP: 600,
          damage: 400,
          alive: true,
        },
      ];

      //la til anger på dragen så den ikke angriper HVER gang noen slår den. dette for å skape en unpredictable følelse i spillet. Mer organisk
      // Ga dragen 1500 mer HP for å gjøre spillet litt vanskeligere
      let dragonObject = {
        name: "Daar Dragon",
        maxHP: 3500,
        currentHP: 3500,
        damage: 200,
        alive: true,
        anger: 0,
      };

      //her legger jeg til en kode der hver av heltene får en "sporing/eventlisnter" slikt at vi kan klikke på dem på nettsiden.

      document.querySelector(".healer").addEventListener("click", function () {
        attackDragon(heroesArray[0]);
      });

      document.querySelector(".archer").addEventListener("click", function () {
        attackDragon(heroesArray[1]);
      });

      document.querySelector(".warrior").addEventListener("click", function () {
        attackDragon(heroesArray[2]);
      });

      // Her lager jeg en funksjon som skal vise til angrep fra hero mot dragen, jeg legger til parameteret "hero" som refererer til
      //heltene som gjør angrepet mot dragen

      function attackDragon(hero) {
        //sjekker om helten din lever
        if (hero.alive) {
          if (dragonObject.alive) {
            let damage = hero.damage;

            //For å se dragens liv etter angrep
            dragonObject.currentHP -= damage;

            //Dragen får 0-3 anger hver gang den blir angrepet for å gjøre spillet litt mindre forutsigbart.
            dragonObject.anger += Math.floor(Math.random() * 4);

            alert(
              hero.name +
                " har påført " +
                damage +
                " heidundranes skade på " +
                dragonObject.name
            );

            //sender dragon inn i update entity text funksjonen.
            updateEntityHealthText(dragonObject);

            //Dragen angriper om den fortsatt er i live, og har 3 eller mer anger. Om dragen angriper settes anger til 0.
            if (dragonObject.currentHP > 0 && dragonObject.anger >= 1) {
              dragonAttack(dragonObject);
              dragonObject.anger = 0;
            }
          }
        } else {
          alert("Helten er død, velg en annen!");
        }
      }
      //vi må nå oppdatere dragens health i HTML sånn at vi enkelt kan se hvor mye damage vi har gjort
      /*function updateDragonHealthText()  {
     const {currentHP, maxHP} = dragonObject;
     //Jeg måtte google meg frem til hvordan kode inn nåværende HP og max hp
     document.querySelector(".dragon-health-txt").textContent =`${currentHP} /${maxHP} HP`;
    }*/

      //Endret funksjonen for å oppdatere health til å fungere for både heroes og dragen.
      function updateEntityHealthText(unit) {
        const { currentHP, maxHP, name } = unit;

        //sjekker hvem som har tatt skaden
        switch (name) {
          case "Henriette Healer":
            healthTextSelector = "#healer-health-txt";
            break;
          case "Ariana Archer":
            healthTextSelector = "#archer-health-txt";
            break;
          case "Wyona Warrior":
            healthTextSelector = "#warrior-health-txt";
            break;
          case "Daar Dragon":
            healthTextSelector = ".dragon-health-txt";
            break;

          //Forlater funksjonen on unit ikke finnes.
          default:
            alert("Unit finnes ikke");
            return;
        }

        document.querySelector(
          healthTextSelector
        ).textContent = `${currentHP} / ${maxHP} HP`;
      }

      //Jeg måtte oppdatere denne for at spillet skulle sjekke om heltene var døde.
      function dragonAttack(dragon) {
        //Dragen velger tilfeldig target fra hero array;
        let dragonTarget = Math.floor(Math.random() * 3);

        //sjekker om target lever, om target er død velger vi på nytt.
        if (heroesArray[dragonTarget].alive) {
          heroesArray[dragonTarget].currentHP -= dragonObject.damage;

          //sette status til død om helten går tom for liv
          if (heroesArray[dragonTarget].currentHP <= 0) {
            heroesArray[dragonTarget].alive = false;
            heroesArray[dragonTarget].currentHP = 0;

            // Fjerner helten fra nettleseren
            //koden under ville ikke fjerne hero etter at den har blitt slått. brukte lang tid til å forstå at jeg måtte ha
            //(' ')[1].toLowerCase()}`) og ikke (' ')[0].toLowerCase()}`)
            // lagde jeg i praksis et array, så det inni [] bestemmer hvilken index jeg skal beholde



            document.querySelector(
              `.${heroesArray[dragonTarget].name.split(" ")[1].toLowerCase()}`
            ).remove();
          }
        } else {
          dragonAttack(dragon);
        }

        alert(
          dragon.name +
            " har påført " +
            dragon.damage +
            " heidundranes skade på " +
            heroesArray[dragonTarget].name
        );

        // Sender dragontarget inn i update entity text funksjonen som linker til koden som
        //skal oppdatere om helter er levende eller ikke.
        updateEntityHealthText(heroesArray[dragonTarget]);

        // Sjekker om alle heltene er døde
        //const allHeroesDead = heroesArray.every((hero) => !hero.alive);
       // if (allHeroesDead) {
          // Viser en alert når alle heltene er døde
        //  alert("Alle heltene er døde!");
       // }

        // Etter dragens angrep, sjekk spilletstatus
        checkGameStatus();
      }

      // Lage en alert når alle heltene er død

      function checkGameStatus() {
        // Sjekk om spillet er tapt
        if (
          dragonObject.currentHP > 0 &&
          heroesArray.every((hero) => !hero.alive)
        ) {
          alert("Spillet er tapt! " + dragonObject.name + " har vunnet!");
        }
      }
    </script>
  </body>
</html>
